import{d as ve,r as g,K as pe,c as me,L as u,j as S,m as w,e as fe,H as ge,M as p,y as I,o as T,s as o,b as v,g as q,p as n,h as m,t as L,u as A,P as ye,N as Z,S as _e,O as be}from"./app-CKRJY2F8.js";import{i as we,a as Se,b as ke,c as he,F as xe}from"./FullCalendar-CKJTkntB.js";import{_ as Ce}from"./AppLayout.vue_vue_type_script_setup_true_lang-Ct8JXGRP.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bcb3fFpx.js";import"./useForwardExpose-B07MqVxp.js";import"./VisuallyHidden-DZ6F9zcq.js";import"./RovingFocusGroup-CatCWtpt.js";import"./useArrowNavigation-C6Y-ieo6.js";import"./index-CaeFeOCz.js";import"./createLucideIcon-BNKRMJ0R.js";const De={class:"w-full h-full"},Oe={class:"h-full bg-white/95 shadow-[0_8px_30px_rgb(0,0,0,0.06)] ring-1 ring-latte-200/70 overflow-hidden"},Ie={class:"flex items-center justify-between px-3 py-2 border-b border-black/5"},Te={class:"flex items-center gap-2"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ge={class:"flex items-center gap-2"},Me={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ae={class:"flex justify-between mt-4"},$e="1061288445293-isu2t7gl3256g5825d7a6k941alshl2i.apps.googleusercontent.com",Pe="AIzaSyCNDRzrfwUyoz9W5P9ksd8VQPnvIuu1V0M",ze="https://www.googleapis.com/auth/calendar.readonly",Re="YYYY-MM-DDTHH:mm:ssZ",Fe=ve({__name:"Index",setup(Ue){const K=[{title:"Calendar",href:"calendar"}],k=e=>w(e).format(Re),P=()=>h.value?.getApi()?.refetchEvents(),h=g(),f=g([]),x=g(!1),_=g(!1),b=g(!1),z=g(),a=pe({title:"",description:"",all_day:!1,start:"",end:"",color:"#1677ff",location:"",meta:{}}),Y=g(!1),C=g(!1);let E=null,R=!1,F=!1;const Q=me(()=>C.value?"Refresh":"Authorize");function U(e,t={}){return new Promise((l,i)=>{const r=Array.from(document.scripts).find(c=>c.src===e);if(r){if(r.dataset.loaded==="1")return l();r.addEventListener("load",()=>l()),r.addEventListener("error",()=>i(new Error(`Failed to load ${e}`)));return}const d=document.createElement("script");d.src=e,d.async=!0,d.defer=!0,Object.entries(t).forEach(([c,D])=>d.setAttribute(c,D)),d.addEventListener("load",()=>{d.dataset.loaded="1",l()}),d.addEventListener("error",()=>i(new Error(`Failed to load ${e}`))),document.head.appendChild(d)})}async function J(){await new Promise(e=>{gapi.load("client",async()=>{await gapi.client.init({apiKey:Pe,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]}),R=!0,e()})}),B()}function X(){E=google.accounts.oauth2.initTokenClient({client_id:$e,scope:ze,callback:()=>{}}),F=!0,B()}function B(){R&&F&&(Y.value=!0)}async function j(){return E?new Promise(e=>{E.callback=t=>{if(t?.error)return u.error(String(t.error)),e(!1);C.value=!0,e(!0)},gapi.client.getToken()===null?E.requestAccessToken({prompt:"consent"}):E.requestAccessToken({prompt:""})}):!1}function ee(){const e=gapi?.client?.getToken?.();e&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken(null)),C.value=!1}async function te(e,t){const l=[];let i;do{const r=await gapi.client.calendar.events.list({calendarId:"primary",timeMin:e,timeMax:t,showDeleted:!1,singleEvents:!0,maxResults:2500,orderBy:"startTime",pageToken:i});l.push(...r.result.items??[]),i=r.result.nextPageToken}while(i);return l}function ae(e){const t=e.start?.dateTime||e.start?.date,l=e.end?.dateTime||e.end?.date,i=!!(e.start?.date&&!e.start?.dateTime);return{id:`gcal_${e.id}`,title:e.summary||"(no title)",description:e.description||null,all_day:i,start:i?w(t).format("YYYY-MM-DD"):k(t),end:l?i?w(l).format("YYYY-MM-DD"):k(l):null,color:"#722ed1",location:e.location||null,meta:{source:"google",htmlLink:e.htmlLink,attendees:e.attendees,organizer:e.organizer,raw:e}}}async function N(){const e=h.value?.getApi(),t=e?.view?.activeStart,l=e?.view?.activeEnd;if(!(!t||!l||!await j()))try{x.value=!0;const d=(await te(t.toISOString(),l.toISOString())).map(ae),c=y=>String(y.id).startsWith("gcal_"),D=y=>{const G=w(y.start),M=w(t),$=w(l);return G.isAfter(M.subtract(1,"minute"))&&G.isBefore($.add(1,"minute"))};f.value=[...f.value.filter(y=>!(c(y)&&D(y))),...d],u.success(`Synced ${d.length} Google events to this view`),P()}catch(r){console.error(r),u.error(r?.message||"Failed to sync Google Calendar")}finally{x.value=!1}}const V=async e=>{x.value=!0;try{const{data:t}=await S.get("/events",{params:e||{}});f.value=t,P()}finally{x.value=!1}},W=()=>{a.title="",a.description="",a.all_day=!1,a.start="",a.end="",a.color="#1677ff",a.location="",a.meta={},b.value=!1},H=(e,t)=>{W(),a.start=e,a.end=t||e,_.value=!0},le=e=>{W(),b.value=!0;const t=e.event.extendedProps.full||{id:String(e.event.id),title:e.event.title,all_day:e.event.allDay,start:e.event.start?.toISOString()||"",end:e.event.end?.toISOString()||"",color:e.event.backgroundColor||"#1677ff"};Object.assign(a,t),_.value=!0},ne=async()=>{try{if(await z.value?.validate?.(),b.value&&a.id&&!String(a.id).startsWith("gcal_")){const{data:e}=await S.put(`/events/${a.id}`,a),t=f.value.findIndex(l=>l.id===e.id);t>-1&&(f.value[t]=e),u.success("Event updated")}else if(b.value)u.info("Google-synced events are read-only here.");else{const{data:e}=await S.post("/events",a);f.value.push(e),u.success("Event created")}_.value=!1}catch{}},oe=async()=>{if(a.id){if(String(a.id).startsWith("gcal_")){u.info("Delete Google events in Google Calendar directly.");return}await S.delete(`/events/${a.id}`),f.value=f.value.filter(e=>e.id!==a.id),u.success("Event deleted"),_.value=!1}},se=g({height:"100%",eventDidMount(e){const t=e.event.extendedProps?.full?.color||e.event.backgroundColor||void 0;t&&(e.el.style.backgroundColor=t,e.el.style.borderColor=t,e.el.style.color="#fff",e.el.style.opacity="0.85")},timeZone:"UTC",plugins:[we,Se,ke,he],initialView:"dayGridMonth",headerToolbar:{left:"prev,next today gsync",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},customButtons:{gsync:{text:"Sync Google Calendar",click:async()=>{if(!Y.value){u.loading("Loading Google libraries…",1);return}await N()}}},selectable:!0,editable:!0,selectMirror:!0,displayEventTime:!1,eventTimeFormat:{hour:"2-digit",minute:"2-digit"},select:e=>{const t=k(e.start),l=e.end?k(e.end):t;a.all_day=!!e.allDay||e.startStr.length===10,H(l,l)},eventClick:le,eventDrop:async e=>{const t=String(e.event.id);if(t.startsWith("gcal_")){e.revert(),u.info("Google-synced events are read-only here.");return}const l={start:e.event.start?.toISOString(),end:e.event.end?.toISOString()||null,all_day:e.event.allDay};await S.put(`/events/${t}`,l),u.success("Event moved")},eventResize:async e=>{const t=String(e.event.id);if(t.startsWith("gcal_")){e.revert(),u.info("Google-synced events are read-only here.");return}const l={start:e.event.start?.toISOString(),end:e.event.end?.toISOString()||null};await S.put(`/events/${t}`,l),u.success("Event resized")},datesSet:async e=>{await V({startStr:e.startStr,endStr:e.endStr})},events:(e,t)=>{t(f.value.map(l=>({id:String(l.id),title:l.title,start:l.start,end:l.end||void 0,allDay:l.all_day,backgroundColor:l.color||void 0,borderColor:l.color||void 0,extendedProps:{full:l}})))}});fe(async()=>{await ge();const e=h.value?.getApi(),t=e?.view?.activeStart?.toISOString(),l=e?.view?.activeEnd?.toISOString();await V({startStr:t,endStr:l});try{await U("https://apis.google.com/js/api.js"),await J(),await U("https://accounts.google.com/gsi/client"),X()}catch(i){console.warn("Google scripts failed to load",i)}});const re=()=>{const e=h.value?.getApi()?.getDate()??new Date;H(k(w(e).startOf("day").toDate()))},ie=[{value:"#1677ff",label:"Blue"},{value:"#52c41a",label:"Matcha"},{value:"#faad14",label:"Caramel"},{value:"#f5222d",label:"Rose"},{value:"#722ed1",label:"Lavender"},{value:"#b08d57",label:"Oat"},{value:"#7cc4a4",label:"Pistachio"}];return(e,t)=>{const l=p("a-alert"),i=p("a-tag"),r=p("a-button"),d=p("a-input"),c=p("a-form-item"),D=p("a-textarea"),y=p("a-checkbox"),G=p("a-select"),M=p("a-date-picker"),$=p("a-form"),de=p("a-modal");return T(),I(Ce,{breadcrumbs:K},{default:o(()=>[v("div",De,[x.value?(T(),I(l,{key:0,type:"info","show-icon":"",message:"Loading events...",class:"mb-3 latte-alert"})):q("",!0),v("div",Oe,[v("div",Ie,[t[15]||(t[15]=v("div",{class:"text-sm text-latte-500"},"FullCalendar",-1)),v("div",Te,[Y.value?(T(),I(i,{key:0,color:"success",class:"rounded-full"},{default:o(()=>t[12]||(t[12]=[m("Google Ready",-1)])),_:1,__:[12]})):(T(),I(i,{key:1,color:"default",class:"rounded-full"},{default:o(()=>t[13]||(t[13]=[m("Google Loading…",-1)])),_:1,__:[13]})),n(r,{size:"small",onClick:t[0]||(t[0]=s=>C.value?ee():j())},{default:o(()=>[m(L(C.value?"Sign out":Q.value),1)]),_:1}),n(r,{type:"primary",size:"small",onClick:N,disabled:!Y.value},{default:o(()=>t[14]||(t[14]=[m(" Sync Google Calendar ",-1)])),_:1,__:[14]},8,["disabled"])])]),n(A(xe),{ref_key:"calendarRef",ref:h,options:se.value},null,8,["options"])]),n(r,{class:"fab md:hidden",type:"primary",shape:"round",style:{zIndex:9999},onClick:t[1]||(t[1]=s=>re())},{icon:o(()=>[n(A(ye))]),default:o(()=>[t[16]||(t[16]=m(" Add ",-1))]),_:1,__:[16]}),n(de,{open:_.value,"onUpdate:open":t[11]||(t[11]=s=>_.value=s),title:b.value?"Edit Event":"New Evasdasdent",footer:null,"destroy-on-close":"",width:"560px"},{default:o(()=>[n($,{ref_key:"formRef",ref:z,model:a,layout:"vertical"},{default:o(()=>[n(c,{name:"title",label:"Title",rules:[{required:!0,message:"Title is required"}]},{default:o(()=>[n(d,{value:a.title,"onUpdate:value":t[2]||(t[2]=s=>a.title=s),placeholder:"e.g., Team Standup"},null,8,["value"])]),_:1}),n(c,{label:"Description",name:"description"},{default:o(()=>[n(D,{value:a.description,"onUpdate:value":t[3]||(t[3]=s=>a.description=s),"auto-size":"",placeholder:"Optional notes..."},null,8,["value"])]),_:1}),v("div",Ye,[n(c,{label:"All-day",name:"all_day"},{default:o(()=>[n(y,{checked:a.all_day,"onUpdate:checked":t[4]||(t[4]=s=>a.all_day=s)},{default:o(()=>t[17]||(t[17]=[m("All-day",-1)])),_:1,__:[17]},8,["checked"])]),_:1}),n(c,{label:"Color",name:"color"},{default:o(()=>[n(G,{value:a.color,"onUpdate:value":t[5]||(t[5]=s=>a.color=s),options:ie,dropdownStyle:{padding:"6px"}},{option:o(({value:s,label:O})=>[v("div",Ge,[v("span",{class:"h-4 w-4 rounded-full border border-black/10",style:Z({background:s})},null,4),v("span",null,L(O),1)])]),tagRender:o(({value:s,label:O,closable:ce,onClose:ue})=>[n(i,{closable:ce,onClose:ue,class:"rounded-full",style:Z({background:s,color:"#fff",border:"none"})},{default:o(()=>[m(L(O),1)]),_:2},1032,["closable","onClose","style"])]),_:1},8,["value"])]),_:1})]),v("div",Me,[n(c,{label:"Start",name:"start",rules:[{required:!0,message:"Start is required"}]},{default:o(()=>[n(M,{value:a.start,"onUpdate:value":t[6]||(t[6]=s=>a.start=s),"show-time":!a.all_day,"value-format":a.all_day?"YYYY-MM-DD":"YYYY-MM-DDTHH:mm:ssZ",style:{width:"100%"}},null,8,["value","show-time","value-format"])]),_:1}),n(c,{label:"End",name:"end"},{default:o(()=>[n(M,{value:a.end,"onUpdate:value":t[7]||(t[7]=s=>a.end=s),"show-time":!a.all_day,"value-format":a.all_day?"YYYY-MM-DD":"YYYY-MM-DDTHH:mm:ssZ",style:{width:"100%"}},null,8,["value","show-time","value-format"])]),_:1})]),v("div",Le,[n(c,{label:"Location",name:"location"},{default:o(()=>[n(d,{value:a.location,"onUpdate:value":t[8]||(t[8]=s=>a.location=s),placeholder:"Optional"},null,8,["value"])]),_:1}),n(c,{label:"Tags (meta.tags)"},{default:o(()=>[n(d,{value:(a.meta?.tags||[]).join(", "),"onUpdate:value":t[9]||(t[9]=s=>{a.meta={...a.meta||{},tags:s.split(",").map(O=>O.trim()).filter(Boolean)}}),placeholder:"Comma separated"},null,8,["value"])]),_:1})]),v("div",Ae,[n(A(_e),null,{default:o(()=>[n(r,{onClick:t[10]||(t[10]=s=>_.value=!1)},{default:o(()=>t[18]||(t[18]=[m("Cancel",-1)])),_:1,__:[18]}),n(r,{type:"primary",onClick:ne},{default:o(()=>[m(L(b.value?"Save":"Create"),1)]),_:1})]),_:1}),b.value?(T(),I(A(be),{key:0,title:"Delete this event?","ok-text":"Delete","ok-type":"danger",onConfirm:oe},{default:o(()=>[n(r,{danger:""},{default:o(()=>t[19]||(t[19]=[m("Delete",-1)])),_:1,__:[19]})]),_:1})):q("",!0)])]),_:1},8,["model"])]),_:1},8,["open","title"])])]),_:1})}}}),Xe=Ee(Fe,[["__scopeId","data-v-0da5c65c"]]);export{Xe as default};
